<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Document</title>
    <script src="//unpkg.com/three"></script>
    <script src="//unpkg.com/three-spritetext"></script>
    <script src="../dist/3d-force-graph.js"></script>
</head>
<body>
    <div id = "3d-graph"></div>
</body>


<script>
    const gData = {
      nodes: 
    //   [
    //     {"id":"4062045","user":"mbostock","description":"Force-Directed Graph"},
    //     {"id":"1341021","user":"mbostock","description":"Force-Directed Graph"}],

            [
                {
                    "id": "Domain_61befc70",
                    "name":"Domain_6",
                    "group":3,
                },
                {
                    "id":"Whois_Name_db09",
                    "name":"Name",
                    "group":4
                },
                {
                    "id":"Domain_c58c149e",
                    "name":"Domain_c",
                    "group":3
                },
                {
                    "id":"Whois_Email_5a3",
                    "name":"Email",
                    "group":6
                },
                {
                    "id":"Whois_Phone_f69",
                    "name":"Phone",
                    "group":5
                },
                {
                    "id":"Cert_fe794a69ea",
                    "name":"Cert",
                    "group":1
                }
               
            ],    
            //   links: [{"source":"4062045","target":"1341021"}]
            links:
            [
                {
                    "source": "Domain_61befc70",
                    "target": "Whois_Name_db09",
                    "value": "r_whois_name"
                },
                {
                    "source": "Domain_c58c149e",
                    "target": "Whois_Name_db09",
                    "value": "r_whois_name"
                },
                {
                    "source": "Domain_61befc70",
                    "target": "Whois_Email_5a3",
                    "value": "r_whois_email"
                },
                {
                    "source": "Domain_61befc70",
                    "target": "Whois_Phone_f69",
                    "value": "r_whois_phone"
                },
                {
                    "source": "Domain_61befc70",
                    "target": "Domain_c58c149e",
                    "value": "r_cname"
                },
                {
                    "source": "Domain_61befc70",
                    "target": "Cert_fe794a69ea",
                    "value": "r_cert"
                }

            ]
        }
    const colorMap = {
        Domain: '#4BA3BB',
        IP:'#3A5A81',
        Cert:'#E9A3A1',
        Whois_Email: '#A5E7F0',
        Whois_Name:'#A5E7F0',
        Whois_Phone:'#A5E7F0',
        IP_C:'#EEEEEE',
        ASN:'#EEEEEE'
    }
    const valColorMap = {
        r_cert: '#D9143B',
        r_subdomain:'#D9143B',//red
        r_request_jump:'#4D1792',
        r_dns_a: '#D9143B',
        r_whois_name:'#737373',
        r_whois_email:'#737373',
        r_whois_phone:'#737373',
        r_cert_chain:'#B3B3B3',
        r_cname:'#2CC48B',
        r_asn:'#CCCCCC',
        r_cidr:'#CCCCCC'
    }


    const myGraph = ForceGraph3D()
    myGraph(document.getElementById('3d-graph'))    
        // .jsonUrl('first.json')
        // .jsonUrl('second.json')
        // .jsonUrl('third.json')
        // .jsonUrl('first_expend.json')
        .jsonUrl('third_expend.json')
        

        .backgroundColor('#FFFFFF')
        .nodeColor(function(d) {
            return colorMap[d.group]
        })
        .nodeOpacity(0.7)
        .nodeLabel(d => `<span style="color: black">${d.name}</span>`)
        // .nodeOpacity(function(d) {
        //     return nodeOpacityMap[d.group]
        // })
        // .linkColor(() => 'rgb(0,11,40)')
        .linkColor(function(d) {
            return valColorMap[d.value]
        })
        // .linkAutoColorBy('value')
        .linkThreeObjectExtend(true)
        .linkOpacity(0.3)
        .linkDirectionalArrowLength(3.5)
        .linkDirectionalArrowRelPos(0.5)
        .linkThreeObject(link => {
          // extend link with text sprite
          const sprite = new SpriteText(`${link.value}`);
          sprite.color = '#737373';
          sprite.textHeight = 3;
          return sprite;
        })
        .linkPositionUpdate((sprite, { start, end }) => {
          const middlePos = Object.assign(...['x', 'y', 'z'].map(c => ({
            [c]: start[c] + (end[c] - start[c]) / 2 // calc middle point
          })));

          // Position sprite
          Object.assign(sprite.position, middlePos);
        });

    // Spread nodes a little wider
    myGraph.d3Force('charge').strength(-500);

        
        // .enableNavigationControls(true);
        

</script>
</html>